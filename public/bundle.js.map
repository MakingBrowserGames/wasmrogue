{"version":3,"file":"bundle.js","sources":["../src/Display.ts","../build/manual.wasm","../src/interface.ts","../src/index.ts"],"sourcesContent":["import { WasmInterface } from \"./interface\";\r\n\r\nexport class Display {\r\n  e: HTMLTextAreaElement;\r\n\r\n  constructor(private i: WasmInterface) {\r\n    this.e = document.createElement(\"textarea\");\r\n    this.e.cols = i.width + 2;\r\n    this.e.rows = i.height;\r\n    this.e.readOnly = true;\r\n\r\n    document.body.append(this.e);\r\n    this.refresh();\r\n  }\r\n\r\n  refresh() {\r\n    let s = \"\";\r\n    let i = 0;\r\n    for (let y = 0; y < this.i.height; y++) {\r\n      s += \"\\n\";\r\n      for (let x = 0; x < this.i.width; x++) {\r\n        const ch = String.fromCharCode(this.i.tiles[i]);\r\n        i++;\r\n\r\n        s += ch;\r\n      }\r\n    }\r\n\r\n    this.e.value = s.substr(1);\r\n  }\r\n}\r\n","export default \"63ad89014d9b6c49.wasm\"","import module from \"../build/manual.wasm\";\n\ninterface ModuleInterface {\n  gHeight: WebAssembly.Global;\n  gWidth: WebAssembly.Global;\n  gTiles: WebAssembly.Global;\n  memory: WebAssembly.Memory;\n  draw(x: number, y: number, ch: number): void;\n  initialise(w: number, h: number): void;\n}\n\nexport class WasmInterface {\n  constructor(private i: ModuleInterface) {}\n\n  get width(): number {\n    return this.i.gWidth.value;\n  }\n  get height(): number {\n    return this.i.gHeight.value;\n  }\n  get tileSize(): number {\n    return this.width * this.height;\n  }\n\n  get tiles() {\n    return new Uint8Array(\n      this.i.memory.buffer.slice(this.i.gTiles.value, this.tileSize)\n    );\n  }\n\n  draw(x: number, y: number, ch: string): void {\n    return this.i.draw(x, y, ch.charCodeAt(0));\n  }\n\n  initialise(width: number, height: number): void {\n    return this.i.initialise(width, height);\n  }\n}\n\nconst getInterface = () =>\n  WebAssembly.instantiateStreaming(fetch(module)).then(\n    ({ instance }) =>\n      new WasmInterface(instance.exports as unknown as ModuleInterface)\n  );\n\nexport default getInterface;\n","import { Display } from \"./Display\";\r\nimport getInterface from \"./interface\";\r\n\r\ngetInterface().then((i) => {\r\n  (window as any).i = i;\r\n\r\n  i.initialise(80, 50);\r\n\r\n  const px = Math.floor(i.width / 2);\r\n  const py = Math.floor(i.height / 2);\r\n  i.draw(px, py, \"@\");\r\n\r\n  (window as any).d = new Display(i);\r\n});\r\n"],"names":[],"mappings":"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"}